<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Family Dashboard</title>
    <link rel="stylesheet" href="css/socialfeed.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <div class="dashboard-header">
      <div class="logo">
        <a href="#" id="scrollToTop">
          <img src="./icons/logo.png" alt="Logo" class="logo-img">
        </a>
      </div>
      <div class="notification-icon" id="notificationIcon">
        <i class="fas fa-bell"></i>
        <span class="notification-count" id="notificationCount">0</span>
      </div>
      <div class="logout-icon" id="logoutIcon">
        <i class="fas fa-sign-out-alt"></i>
      </div>
    </div>
    <div class="notification-dropdown" id="notificationDropdown" style="display: none;">
      <div class="notification-header">
        <h3>Notifications</h3>
        <button id="markAllRead">Mark all as read</button>
      </div>
      <div class="notification-tabs">
        <button id="unreadTab" class="tab active-tab">Unread</button>
        <button id="allTab" class="tab">All</button>
      </div>
      <div id="notificationList"></div>
    </div>
    <div id="logoutModal" class="modal" style="display: none;">
      <div class="modal-content">
        <h2>Session Expired</h2>
        <p>Your session has expired. Please log in again.</p>
        <button id="loginRedirect">Go to Login</button>
      </div>
    </div>
    
    <div class="dashboard">
      <div class="left-column" id="leftColumn">
        <div class="card user-profile">
          <h2>User Profile</h2>
          <div class="profile-content">
            <div id="userAvatar" class="avatar pulse"></div>
            <div class="user-info">
              <h3 id="userName" class="slide-in"></h3>
              <p id="userEmail" class="slide-in"></p>
            </div>
          </div>
        </div>

        <div class="card family-management">
          <h2>Your Families</h2>
          <div id="familySelector" class="family-list"></div>
          <button id="createFamilyBtn" class="create-family-btn">
            <span class="btn-text">Create New Family</span>
            <span class="btn-icon">+</span>
          </button>
        </div>

        <div class="card new-feature">
          <a href="memories.html" class="memories-button">
            <i class="fas fa-star"></i>
            <span class="feature-name">Memories</span>
            <span class="feature-tag">New Feature!</span>
          </a>
        </div>

        <div id="familyView" class="card family-view">
          <h2 id="familyName" class="family-name"></h2>
          <h3>Members:</h3>
          <div class="member-list">
            <ul id="memberList"></ul>
          </div>
          <div class="invite-button-container">
            <button id="inviteMemberBtn" class="invite-member-btn">
              <i class="fas fa-user-plus"></i>
              <span>Invite Member</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="center-column">
        <div class="card social-feed">
          <h2>Family Social Feed</h2>
          <form id="postForm" enctype="multipart/form-data">
            <textarea id="captionInput" placeholder="What's on your mind?" required></textarea>
            <div id="mediaPreview"></div>
            <div class="post-actions">
              <label for="mediaInput" class="media-upload-label">
                <i class="fas fa-image"></i> Add Photo/Video
              </label>
              <input type="file" id="mediaInput" name="media" accept="image/*,video/*" multiple style="display: none" />
              <button type="submit">Post</button>
            </div>
          </form>
          <div id="socialFeedContent"></div>
        </div>
      </div>
      
      <div class="right-column" id="rightColumn">
        <div class="card family-calendar">
          <h2>Family Calendar</h2>
          <div class="calendar-header">
            <button id="prevMonth">&lt;</button>
            <span id="monthYear"></span>
            <button id="nextMonth">&gt;</button>
          </div>
          <div id="calendarGrid" class="calendar"></div>
        </div>
        <div class="card event-list">
          <h2>Upcoming Events</h2>
          <ul id="eventList"></ul>
        </div>
      </div>
    </div>
    
    <!-- Media Gallery Modal for multiple images/videos -->
    <div id="media-gallery-modal" class="modal media-gallery-modal">
      <div class="modal-content gallery-modal-content">
        <span class="close">&times;</span>
        <div class="gallery-container">
          <div class="gallery-main"></div>
          <div class="gallery-caption">
            <div class="gallery-author"></div>
            <div class="gallery-text"></div>
          </div>
          <div class="gallery-thumbnails"></div>
        </div>
        <button class="gallery-nav prev"><i class="fas fa-chevron-left"></i></button>
        <button class="gallery-nav next"><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
    
    <!-- YouTube Modal -->
    <div id="youtube-modal" class="modal youtube-modal">
      <div class="modal-content youtube-modal-content">
        <span class="close">&times;</span>
        <div class="youtube-container">
          <iframe width="100%" height="100%" frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen></iframe>
        </div>
      </div>
    </div>
    
    <!-- Event Modal -->
    <div id="eventModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close" id="closeModalButton">&times;</span>
        <form id="eventForm">
          <input type="hidden" id="eventId" />
          <label for="eventType">Event Type:</label>
          <select id="eventType" required>
            <option value="birthday">Birthday</option>
            <option value="anniversary">Anniversary</option>
            <option value="other">Other</option>
          </select>
          <label for="eventTitle">Title:</label>
          <input type="text" id="eventTitle" required />
          <label for="eventDate">Date:</label>
          <input type="date" id="eventDate" required />
          <label for="eventDescription">Description:</label>
          <textarea id="eventDescription"></textarea>
          <div id="recurringOption">
            <label for="isRecurring">
              <input type="checkbox" id="isRecurring" />
              Recurring yearly?
            </label>
          </div>
          <button type="submit" id="saveEventButton">Save Event</button>
        </form>
        <button id="deleteEvent" style="display: none">Delete Event</button>
      </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="floating-icons">
        <div class="icon" id="toggleLeftColumn">
            <i class="fas fa-bars"></i>
        </div>
        <div class="icon plus-icon" id="togglePostForm">
            <i class="fas fa-plus"></i>
        </div>
        <div class="icon" id="toggleRightColumn">
            <i class="fas fa-calendar-alt"></i>
        </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/pushNotifications.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/socialFeed.js"></script>
    <script src="js/dashboard.js"></script>
    <script>
      // Initialize social feed when the DOM is loaded
      document.addEventListener("DOMContentLoaded", function() {
        // This function is defined in enhanced-social-feed.js
        initializeSocialFeed();
        
        // Toggle functionality for mobile
        document.getElementById("toggleLeftColumn").addEventListener("click", function() {
          toggleElementVisibility("leftColumn");
        });

        document.getElementById("togglePostForm").addEventListener("click", function() {
          toggleElementVisibility("postForm");
        });

        document.getElementById("toggleRightColumn").addEventListener("click", function() {
          toggleElementVisibility("rightColumn");
        });

        document.getElementById("overlay").addEventListener("click", function() {
          closeAllElements();
        });
      });
      
      // Function to toggle element visibility on mobile
      function toggleElementVisibility(elementId) {
        const element = document.getElementById(elementId);
        const overlay = document.getElementById("overlay");

        if (element) {
          if (element.classList.contains("open")) {
            element.classList.remove("open");
            overlay.classList.remove("active");
          } else {
            closeAllElements(); 
            element.classList.add("open");
            overlay.classList.add("active");
          }
        }
      }

      // Function to close all mobile elements
      function closeAllElements() {
        document.getElementById("leftColumn")?.classList.remove("open");
        document.getElementById("rightColumn")?.classList.remove("open");
        document.getElementById("postForm")?.classList.remove("open");
        document.getElementById("overlay")?.classList.remove("active");
      }
    </script>
  </body>
</html>